- 1.发布与订阅消息系统


数据（消息）的发送者（发布者）不会直接把消息发送给接收
者，这是发布与订阅消息系统的一个特点。发布者以某种方式对消息进行分类，接收者
（订阅者）订阅它们，以便接收特定类型的消息。发布与订阅系统一般会有一个 roker ，也
就是发布消息的中心点。
它 般被称为“分布式提交臼志”或者“分布式流平台”。文件系统或数据库提交日志用来提供所有事务
的持久记录 通过重放这些日志可以重建系统的状态。同样地， Kafka 的数据是按照一定
顺序持久化保存的，可以按需读取 此外， fk 的数据分布在整个系统里，具备数据故
障保护和性能伸缩能力。
- 2.消息系统有啥用？
服务解耦
冗余
可拓展
灵活，削峰
持久化，可恢复
缓冲
异步通信

- **3 kafka的基本概念**
-- 主题，分区
kafka的悄息通过主题（topic）进行分类。主题就好比数据库的表，或者文件系统里的文件夹。主
题可以被分为若干个分区（partition）一个个分区就是一个提交日志。消息以追加的方式写入分区（顺序IO，速度性能接近内存），然
后以先入先出（FIFO）的顺序读取。要注意，由于一个主题一般包含几个分区，因此无发在整个主
题范围内保证消息的顺序，但可以保证消息在单个分区内的顺序。主题有多
个分区，消息被追加写入每个分区的尾部。 kafka通过分区来实现数据冗余和伸缩性。分
区可以分布在不同的服务器上，也就是说， 个主题可以横跨多个服务器，以此来提供比
个服务器更强大的性能。
![image](https://user-images.githubusercontent.com/33997121/79068076-ab8a7b80-7cf6-11ea-851e-5eac1af0a9e2.png)
-- 生产者，消费者
kafka的客户端就是kafka服务端的用户，分为生产者和消费者，
**生产者**：负责创建消息，也被成为发布者，写入者，一般情况下，生产者生产的消息被发送到特定的主题topic，生产者默认情况下会将消息均匀的分布在所有的分区上，而不关心消息具体被写到哪个分区，也可以将消息发送到特定的分区，通过分区键即可实现，分区策略可以有开发者自定义编写分区器，根据不同的业务规则分配到不同的分区上。
**消费者**：消费者是消费者组的一部分，也就是说会有多个消费者共同去读取某一个topic，对于同一个topic的一条消息只能被消费者组里的一个成员服务，不同的消费者组互相不影响消费

- **broker和集群**
一个独立的 Kafka 服务器被称为 bro胎儿 broker 接收来自 生产者的消息，为消息设置偏移量，并提交消息到磁盘保存。 broker 为消费者提服务，对读取分区的请求作出响应，返回已经提交到磁盘上的消息。根据特定的硬件及其性能特征，单个 broker 可以轻松处理数千个分区以及每秒百万级的消息量。
broker 是集群的组成部分。每个集群都有 broker 同时充当了集群控制器的角色（自动从集群的活跃成员中选举出来）。控制器负责管理工作，包括将分区分配给 broker 和监控broker. 在集群中， 个分区从属于 broker, broker 被称为分区的首领。一个分可以分配给多个 broke ，这个时候会发生分区复制。这种复制机制为分区提供了消息冗余，如果有一个 broker 失效，其他 broker 可以接管领导权。不过，相关的消费者
和生产者都要重新连接到新的首领。
**集群里的分区复制**
保留消息（在 定期限内）是 Kafka 个重要特性。 Kafka broker 默认的消息保留策略是这样的：要么保留 段时间（比如 天），要么保留到消息达到一定大小的字节数（比lGB ）。当消息数量达到这些上限时，旧消息就会过期井被 除，所以在任何时刻，用消息的总量都不会超过配置参数所指定的大小。主题可以配置自己的保留策略，可以将悄息保留到不再使用它们为止。
**多集群**
随着 Kafka 部署数量的增加，基于以下几点原因，最好使用多个集群。

1. 数据类型分离
2. .安全需求隔离
3. .多数据中心（灾难恢复）

如果使用多个数据中心，就需要在它们之间复制消息。这样，在钱应用程序才可以访问到多个姑点的用户活动信息。例如，如果 个用户修改了他们的资料信息，不管从哪个数据中心都应该能看到这些改动。或者多个站点的监控数据可以被聚集到 个部署了分析程序和告警系统的中心位置。不过， Kafka 的消息复制机制只能在单个集群里进行，不能在多个集群之间进行。Kafka 提供了 个叫作 Mirror Maker 的工具，可以用它来实现集群间的消息复制。Mirror Maker 的核心组件包含了 个生产者和一个消费者，两者之间通过一个队列相连。

- **为什么选择Kafka**
**多个生产者**
Kafka 可以无缝地支持多个生产者，不管客户端在使用单个主题还是多个主题。所以它很适合用来从多个前端系统收集数据，并以统 的格式对外提供数据。例如， 个包含了个微服务的网站，可以为页面视图创建 个单独的主题，所有服务都以相同的消息格式向该主题写入数据。消费者应用程序会获得统一的页面视图，而无需协调来自不同生产者的数据流。
**多个消费者**
除了支持多个生产者外， Kafka 也支持多个消费者从 个单独的消息流上读取数据，而消费者之间直不影响。这与其他队列系统不同，其他队列系统的消息 旦被一个客户端读取，其他客户端就无法再读取它。另外，多个消费者可以组成 个群组，它们共享一个悄息流，并保证整个群组对每个给定的消息只处理 1次。

**基于磁盘的数据存储**
kafka不仅支持多个消费者而且支持消费者非实时的消费消息，这得益于kafka基于磁盘的存储，消费者可以宕机几个小时，再次重启后可以从之前消费的位置开始继续消费

**高性能**
通过横向拓展生产者，消费者和broker让kafka可以轻松应对和处理巨大的消息流，在处理大数据量的同时还能保证消息处理低延迟。
向kafka写入数据

最简单的方式：
`ProducerRecord<String, String> producerRecord = new ProducerRecord<>("topic","key","value"); KafkaProducer kafkaProducer = new KafkaProducer(getPerties()); kafkaProducer.send(producerRecord);`




































